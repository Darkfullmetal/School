<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Character Page - FFXI Gear Swap Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="wrapper">
    <header>
        <div class="character-header-images">
            <img src="https://raw.githubusercontent.com/Darkfullmetal/School/refs/heads/main/project4/images/ffxiraces.png" class="character-header-img left" alt="FFXI Races">
            <h1>Character Page</h1>
            <img src="https://raw.githubusercontent.com/Darkfullmetal/School/refs/heads/main/project4/images/ffxiraces.png" class="character-header-img right" alt="FFXI Races">
        </div>
        <nav>
            <a href="index.html">Home</a>
            <a href="#" id="character-link" class="active">Character</a>
            <a href="wishlist.html">Wishlist</a>
            <a href="tips.html">Tips/Links</a>
            <a href="signin.html">Sign In/Register</a>
            <a href="#" id="signout-link">Sign Out</a>
        </nav>
    </header>
    <main>
        <script>
        // Only character.html and wishlist.html require sign-in. Sign out logic and session timeout remain consistent.
        function setSignInTimeout() {
            localStorage.setItem('signedInUserTimeout', Date.now() + 30 * 60 * 1000);
        }
        function checkSignInTimeout() {
            var timeout = localStorage.getItem('signedInUserTimeout');
            if (!timeout || Date.now() > parseInt(timeout)) {
                localStorage.removeItem('signedInUser');
                localStorage.removeItem('signedInUserTimeout');
                window.location.href = 'signin.html';
            }
        }
        document.body.addEventListener('mousemove', setSignInTimeout);
        document.body.addEventListener('keydown', setSignInTimeout);
        document.body.addEventListener('click', setSignInTimeout);
        window.addEventListener('unload', function(e) {
            if (!document.referrer || !document.referrer.includes(window.location.hostname)) {
                localStorage.removeItem('signedInUser');
                localStorage.removeItem('signedInUserTimeout');
            }
        });
        var signedIn = localStorage.getItem('signedInUser');
        checkSignInTimeout();
        if (!signedIn) {
            window.location.href = 'signin.html';
        } else {
            setSignInTimeout();
            var signoutLink = document.getElementById('signout-link');
            signoutLink.classList.add('show-signout');
            signoutLink.onclick = function(e) {
                e.preventDefault();
                localStorage.removeItem('signedInUser');
                localStorage.removeItem('signedInUserTimeout');
                window.location.href = 'index.html';
            };
        }
        </script>
        <script>
        // Intercept Character/Wishlist clicks to show sign-in if not signed in
        document.getElementById('character-link').onclick = function(e) {
            var signedIn = localStorage.getItem('signedInUser');
            if (!signedIn) {
                e.preventDefault();
                window.location.href = 'signin.html';
            }
        };
        document.getElementById('wishlist-link').onclick = function(e) {
            var signedIn = localStorage.getItem('signedInUser');
            if (!signedIn) {
                e.preventDefault();
                window.location.href = 'signin.html';
            }
        };
        </script>
    
        <section>
            <h2>Jobs & Levels</h2>
            <form class="jobs-form" id="jobs-form">
                <label for="job-select">Job:</label>
                <select id="job-select" name="job">
                    <option value="Warrior">Warrior</option>
                    <option value="Monk">Monk</option>
                    <option value="White Mage">White Mage</option>
                    <option value="Black Mage">Black Mage</option>
                    <option value="Red Mage">Red Mage</option>
                    <option value="Thief">Thief</option>
                    <option value="Paladin">Paladin</option>
                    <option value="Dark Knight">Dark Knight</option>
                    <option value="Beastmaster">Beastmaster</option>
                    <option value="Bard">Bard</option>
                    <option value="Ranger">Ranger</option>
                    <option value="Samurai">Samurai</option>
                    <option value="Ninja">Ninja</option>
                    <option value="Dragoon">Dragoon</option>
                    <option value="Summoner">Summoner</option>
                    <option value="Blue Mage">Blue Mage</option>
                    <option value="Corsair">Corsair</option>
                    <option value="Puppetmaster">Puppetmaster</option>
                    <option value="Dancer">Dancer</option>
                    <option value="Scholar">Scholar</option>
                    <option value="Geomancer">Geomancer</option>
                    <option value="Rune Fencer">Rune Fencer</option>
                </select>
                <label for="level-select">Level:</label>
                <select id="level-select" name="level">
                    <option value="1">1</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                    <option value="40">40</option>
                    <option value="50">50</option>
                    <option value="60">60</option>
                    <option value="70">70</option>
                    <option value="75">75</option>
                    <option value="80">80</option>
                    <option value="85">85</option>
                    <option value="90">90</option>
                    <option value="95">95</option>
                    <option value="99">99</option>
                </select>
                <button type="submit">Add Job</button>
            </form>
            <table class="jobs-table" id="added-jobs-table" style="margin-top:20px;">
                <thead>
                    <tr><th>Job</th><th>Level</th><th>Gear Swap</th><th>Wishlist</th></tr>
                </thead>
                <tbody id="added-jobs-body">
                </tbody>
            </table>
            <script>
            // Save/load jobs per user
            function getUserKey(key) {
                var user = localStorage.getItem('signedInUser');
                return user ? key + '_' + user : key;
            }
            function renderJobsTable() {
                var tbody = document.getElementById('added-jobs-body');
                tbody.innerHTML = '';
                var jobs = JSON.parse(localStorage.getItem(getUserKey('jobsList')) || '[]');
                jobs.forEach(function(entry) {
                    var tr = document.createElement('tr');
                    tr.innerHTML = '<td>' + entry.job + '</td>' +
                        '<td>' + entry.level + '</td>' +
                        '<td><a href="wishlist.html?job=' + encodeURIComponent(entry.job) + '#gearswap">Gear Swap</a></td>' +
                        '<td><a href="wishlist.html?job=' + encodeURIComponent(entry.job) + '#wishlist">Wishlist</a></td>';
                    // Remove button
                    var btn = document.createElement('button');
                    btn.textContent = 'Remove';
                    btn.type = 'button';
                    btn.style.marginLeft = '10px';
                    btn.onclick = function() {
                        jobs = jobs.filter(j => j.job !== entry.job);
                        localStorage.setItem(getUserKey('jobsList'), JSON.stringify(jobs));
                        renderJobsTable();
                    };
                    var td = document.createElement('td');
                    td.appendChild(btn);
                    tr.appendChild(td);
                    tbody.appendChild(tr);
                });
            }
            renderJobsTable();
            document.getElementById('jobs-form').addEventListener('submit', function(e) {
                e.preventDefault();
                var job = document.getElementById('job-select').value;
                var level = document.getElementById('level-select').value;
                var jobs = JSON.parse(localStorage.getItem(getUserKey('jobsList')) || '[]');
                // Prevent duplicate jobs
                if (jobs.some(j => j.job === job)) return;
                jobs.push({job: job, level: level});
                localStorage.setItem(getUserKey('jobsList'), JSON.stringify(jobs));
                renderJobsTable();
            });
            </script>
        </section>
        <section>
            <h2>Mission Status</h2>
            <form class="mission-status-form" id="mission-status-form">
                <label for="rank">Nation Rank:</label>
                <select id="rank" name="rank">
                    <option value="In Progress">In Progress</option>
                    <option value="Complete">Complete</option>
                </select><br>
                <label for="zilart">Zilart:</label>
                <select id="zilart" name="zilart">
                    <option value="In Progress">In Progress</option>
                    <option value="Complete">Complete</option>
                </select><br>
                <label for="promathia">Promathia:</label>
                <select id="promathia" name="promathia">
                    <option value="In Progress">In Progress</option>
                    <option value="Complete">Complete</option>
                </select><br>
                <label for="toa">Treasures of Aht Urhgan:</label>
                <select id="toa" name="toa">
                    <option value="In Progress">In Progress</option>
                    <option value="Complete">Complete</option>
                </select><br>
                <label for="wotg">Wings of the Goddess:</label>
                <select id="wotg" name="wotg">
                    <option value="In Progress">In Progress</option>
                    <option value="Complete">Complete</option>
                </select><br>
                <label for="abyssea">Abyssea:</label>
                <select id="abyssea" name="abyssea">
                    <option value="In Progress">In Progress</option>
                    <option value="Complete">Complete</option>
                </select><br>
                <label for="seekers">Seekers of Adoulin:</label>
                <select id="seekers" name="seekers">
                    <option value="In Progress">In Progress</option>
                    <option value="Complete">Complete</option>
                </select><br>
                <label for="rhapsodies">Rhapsodies of Vana'diel:</label>
                <select id="rhapsodies" name="rhapsodies">
                    <option value="In Progress">In Progress</option>
                    <option value="Complete">Complete</option>
                </select>
            </form>
            <script>
            // Save/load mission status per user
            function getUserKey(key) {
                var user = localStorage.getItem('signedInUser');
                return user ? key + '_' + user : key;
            }
            function loadMissionStatus() {
                var data = JSON.parse(localStorage.getItem(getUserKey('missionStatus')) || '{}');
                ['rank','zilart','promathia','toa','wotg','abyssea','seekers','rhapsodies'].forEach(function(id) {
                    if (data[id]) document.getElementById(id).value = data[id];
                });
            }
            function saveMissionStatus() {
                var data = {};
                ['rank','zilart','promathia','toa','wotg','abyssea','seekers','rhapsodies'].forEach(function(id) {
                    data[id] = document.getElementById(id).value;
                });
                localStorage.setItem(getUserKey('missionStatus'), JSON.stringify(data));
            }
            document.getElementById('mission-status-form').addEventListener('change', saveMissionStatus);
            loadMissionStatus();
            </script>
        </section>
        <section>
            <h2>Assault Checklist</h2>
            <form class="assault-checklist-form" id="assault-checklist-form">
                <div class="assault-list">
                    <label><input type="checkbox" name="Leujaoam Sanctum"> Leujaoam Sanctum</label><br>
                    <label><input type="checkbox" name="Periqia"> Periqia</label><br>
                    <label><input type="checkbox" name="Ilrusi Atoll"> Ilrusi Atoll</label><br>
                    <label><input type="checkbox" name="Nyzul Isle"> Nyzul Isle</label><br>
                    <label><input type="checkbox" name="Mamool Ja Training Grounds"> Mamool Ja Training Grounds</label><br>
                    <label><input type="checkbox" name="Golden Salvage"> Golden Salvage</label><br>
                    <label><input type="checkbox" name="Lamia No.13"> Lamia No.13</label><br>
                    <label><input type="checkbox" name="Extermination"> Extermination</label><br>
                    <label><input type="checkbox" name="Escort"> Escort</label><br>
                    <label><input type="checkbox" name="Supplies"> Supplies</label><br>
                    <label><input type="checkbox" name="Breaking Morale"> Breaking Morale</label><br>
                    <label><input type="checkbox" name="Demolition Squad"> Demolition Squad</label><br>
                    <label><input type="checkbox" name="Preemptive Strike"> Preemptive Strike</label><br>
                    <label><input type="checkbox" name="Imperial Code"> Imperial Code</label><br>
                    <label><input type="checkbox" name="The Double Agent"> The Double Agent</label><br>
                    <label><input type="checkbox" name="Searat Salvage"> Searat Salvage</label><br>
                    <label><input type="checkbox" name="Marids in the Mist"> Marids in the Mist</label><br>
                    <label><input type="checkbox" name="Wamouracampa"> Wamouracampa</label><br>
                    <label><input type="checkbox" name="Shanarha Grass Conservation"> Shanarha Grass Conservation</label><br>
                    <label><input type="checkbox" name="Egg Hunt"> Egg Hunt</label><br>
                    <label><input type="checkbox" name="Imperial Treasure Retrieval"> Imperial Treasure Retrieval</label><br>
                    <label><input type="checkbox" name="Azouph Isle Investigation"> Azouph Isle Investigation</label><br>
                    <label><input type="checkbox" name="Orichalcum Survey"> Orichalcum Survey</label><br>
                    <label><input type="checkbox" name="Mercenary Camp"> Mercenary Camp</label><br>
                    <label><input type="checkbox" name="Shooting Down the Baron"> Shooting Down the Baron</label><br>
                    <label><input type="checkbox" name="Lamia Fatedeath"> Lamia Fatedeath</label><br>
                    <label><input type="checkbox" name="The Susanoo Shuffle"> The Susanoo Shuffle</label><br>
                    <label><input type="checkbox" name="Bloody Rondo"> Bloody Rondo</label><br>
                    <label><input type="checkbox" name="The Swarm"> The Swarm</label><br>
                    <label><input type="checkbox" name="Black Coffin"> Black Coffin</label><br>
                    <label><input type="checkbox" name="The Ramparts"> The Ramparts</label><br>
                    <label><input type="checkbox" name="The Price is Right"> The Price is Right</label><br>
                    <label><input type="checkbox" name="The Road to Divadom"> The Road to Divadom</label><br>
                    <label><input type="checkbox" name="The Final Image"> The Final Image</label><br>
                    <label><input type="checkbox" name="The Salt of the Earth"> The Salt of the Earth</label><br>
                    <label><input type="checkbox" name="The Black Coffin"> The Black Coffin</label><br>
                    <label><input type="checkbox" name="The Swarm"> The Swarm</label><br>
                    <label><input type="checkbox" name="The Ramparts"> The Ramparts</label><br>
                    <label><input type="checkbox" name="The Price is Right"> The Price is Right</label><br>
                    <label><input type="checkbox" name="The Road to Divadom"> The Road to Divadom</label><br>
                    <label><input type="checkbox" name="The Final Image"> The Final Image</label><br>
                    <label><input type="checkbox" name="The Salt of the Earth"> The Salt of the Earth</label><br>
                </div>
            </form>
            <script>
            // Save/load assault checklist per user
            function getUserKey(key) {
                var user = localStorage.getItem('signedInUser');
                return user ? key + '_' + user : key;
            }
            function loadAssaultChecklist() {
                var data = JSON.parse(localStorage.getItem(getUserKey('assaultChecklist')) || '{}');
                var checkboxes = document.querySelectorAll('#assault-checklist-form input[type="checkbox"]');
                checkboxes.forEach(function(cb) {
                    cb.checked = !!data[cb.name];
                });
            }
            function saveAssaultChecklist() {
                var data = {};
                var checkboxes = document.querySelectorAll('#assault-checklist-form input[type="checkbox"]');
                checkboxes.forEach(function(cb) {
                    data[cb.name] = cb.checked;
                });
                localStorage.setItem(getUserKey('assaultChecklist'), JSON.stringify(data));
            }
            document.getElementById('assault-checklist-form').addEventListener('change', saveAssaultChecklist);
            loadAssaultChecklist();
            </script>
        </section>
    </main>
    <footer>
        <p>&copy; 2025 FFXI Gear Swap Management</p>
    </footer>
</div>
</body>
</html>
