<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wishlist - FFXI Gear Swap Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="wrapper">
    <header>
        <h1>Wishlist</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="character.html">Character</a>
            <a href="wishlist.html" class="active">Wishlist</a>
            <a href="discussion.html">Discussion</a>
            <a href="tips.html">Tips/Links</a>
            <a href="signin.html">Sign In/Register</a>
        </nav>
    </header>
    <main>
        <div class="wishlist-main-grid">
            <div class="wishlist-left">
                <h2>My Wishlist (Up to 100 Items)</h2>
                <div id="wishlist-locked" style="display:none; color:red; font-weight:bold;">You must be signed in to access your wishlist.</div>
                <form id="wishlist-form" style="display:none;">
                    <label for="item-name">Item Name:</label>
                    <input type="text" id="item-name" name="item-name" maxlength="50" required>
                    <button type="submit">Add Item</button>
                    <button id="save-wishlist-btn" type="button" style="margin-left:10px;">Save Wishlist</button>
                    <span id="wishlist-save-status" style="margin-left:10px;color:green;display:none;">Saved!</span>
                </form>
                <ol class="wishlist-list" id="wishlist-list" style="display:none; margin-top:20px;">
                    <!-- Items will be rendered by JS -->
                </ol>
            </div>
            <div class="wishlist-right">
                <h2>Gear Swap Sets</h2>
                <form id="gearswap-form" style="display:inline;">
                    <label for="gs-job-select">Select Job:</label>
                    <select id="gs-job-select" name="gs-job">
                        <option value="Warrior">Warrior</option>
                        <option value="Monk">Monk</option>
                        <option value="White Mage">White Mage</option>
                        <option value="Black Mage">Black Mage</option>
                        <option value="Red Mage">Red Mage</option>
                        <option value="Thief">Thief</option>
                        <option value="Paladin">Paladin</option>
                        <option value="Dark Knight">Dark Knight</option>
                        <option value="Beastmaster">Beastmaster</option>
                        <option value="Bard">Bard</option>
                        <option value="Ranger">Ranger</option>
                        <option value="Samurai">Samurai</option>
                        <option value="Ninja">Ninja</option>
                        <option value="Dragoon">Dragoon</option>
                        <option value="Summoner">Summoner</option>
                        <option value="Blue Mage">Blue Mage</option>
                        <option value="Corsair">Corsair</option>
                        <option value="Puppetmaster">Puppetmaster</option>
                        <option value="Dancer">Dancer</option>
                        <option value="Scholar">Scholar</option>
                        <option value="Geomancer">Geomancer</option>
                        <option value="Rune Fencer">Rune Fencer</option>
                    </select>
                </form>
                <div class="gearswap-set-grid">
                    <div id="gearswap-sets-container"></div>
                    <button id="save-gearswap-btn" type="button">Save Sets for Job</button>
                    <div id="gearswap-save-status" style="margin-top:10px;color:green;display:none;">Saved!</div>
                </div>
            </div>
        </div>
        <script>
        // Check if user is signed in (simple localStorage flag)
        var signedIn = localStorage.getItem('signedInUser');
        if (!signedIn) {
            window.location.href = 'signin.html';
        } else {
            document.getElementById('wishlist-form').style.display = '';
            document.getElementById('wishlist-list').style.display = '';
        }
        // Wishlist logic with remove and save
        function renderWishlist() {
            const list = document.getElementById('wishlist-list');
            list.innerHTML = '';
            let items = JSON.parse(localStorage.getItem('wishlistItems') || '[]');
            items.forEach((item, idx) => {
                const li = document.createElement('li');
                li.textContent = item;
                // Remove button
                const btn = document.createElement('button');
                btn.textContent = 'Remove';
                btn.type = 'button';
                btn.style.marginLeft = '10px';
                btn.onclick = function() {
                    items.splice(idx, 1);
                    localStorage.setItem('wishlistItems', JSON.stringify(items));
                    renderWishlist();
                };
                li.appendChild(btn);
                list.appendChild(li);
            });
        }

        if (signedIn) {
            // Initial render
            renderWishlist();
            // Add item
            document.getElementById('wishlist-form').addEventListener('submit', function(e) {
                e.preventDefault();
                var itemName = document.getElementById('item-name').value.trim();
                let items = JSON.parse(localStorage.getItem('wishlistItems') || '[]');
                if (itemName && items.length < 100) {
                    items.push(itemName);
                    localStorage.setItem('wishlistItems', JSON.stringify(items));
                    document.getElementById('item-name').value = '';
                    renderWishlist();
                }
            });
            // Save wishlist
            document.getElementById('save-wishlist-btn').addEventListener('click', function() {
                let items = [];
                const list = document.getElementById('wishlist-list');
                for (let i = 0; i < list.children.length; i++) {
                    items.push(list.children[i].childNodes[0].nodeValue.trim());
                }
                localStorage.setItem('wishlistItems', JSON.stringify(items));
                document.getElementById('wishlist-save-status').style.display = '';
                setTimeout(() => { document.getElementById('wishlist-save-status').style.display = 'none'; }, 1500);
            });
        }
        // Per-job gear swap sets logic
        const gearSlots = [
            'Main', 'Sub', 'Range', 'Ammo',
            'Head', 'Neck', 'Ear1', 'Ear2',
            'Body', 'Hands', 'Ring1', 'Ring2',
            'Back', 'Waist', 'Legs', 'Feet'
        ];
        const setNames = ['TP', 'WS', 'Idle', 'DT', 'Special'];
        const jobSelect = document.getElementById('gs-job-select');
        const setsContainer = document.getElementById('gearswap-sets-container');
        const saveBtn = document.getElementById('save-gearswap-btn');
        const saveStatus = document.getElementById('gearswap-save-status');

        function createGearSetTable(setName, values) {
            let html = `<table class='gearswap-grid-table'><thead><tr><th colspan='4'>${setName}</th></tr></thead><tbody>`;
            for (let r = 0; r < 4; r++) {
                html += '<tr>';
                for (let c = 0; c < 4; c++) {
                    let idx = r * 4 + c;
                    let slot = gearSlots[idx];
                    let val = values && values[slot] ? values[slot] : '';
                    html += `<td><input type='text' maxlength='10' pattern='[A-Za-z0-9\-\+]*' title='${slot}' placeholder='${slot}' value='${val}'></td>`;
                }
                html += '</tr>';
            }
            html += '</tbody></table>';
            return html;
        }

        function loadGearSetsForJob(job) {
            let allSets = JSON.parse(localStorage.getItem('gearswapSets') || '{}');
            let jobSets = allSets[job] || {};
            setsContainer.innerHTML = '';
            setNames.forEach(setName => {
                let values = jobSets[setName] || {};
                let setDiv = document.createElement('div');
                setDiv.className = 'gearswap-set-block';
                setDiv.innerHTML = createGearSetTable(setName, values);
                setsContainer.appendChild(setDiv);
            });
        }

        jobSelect.addEventListener('change', function() {
            loadGearSetsForJob(jobSelect.value);
            saveStatus.style.display = 'none';
        });

        saveBtn.addEventListener('click', function() {
            let allSets = JSON.parse(localStorage.getItem('gearswapSets') || '{}');
            let job = jobSelect.value;
            let jobSets = {};
            let setBlocks = setsContainer.getElementsByClassName('gearswap-set-block');
            for (let i = 0; i < setNames.length; i++) {
                let setName = setNames[i];
                let inputs = setBlocks[i].getElementsByTagName('input');
                let setVals = {};
                for (let j = 0; j < gearSlots.length; j++) {
                    setVals[gearSlots[j]] = inputs[j].value;
                }
                jobSets[setName] = setVals;
            }
            allSets[job] = jobSets;
            localStorage.setItem('gearswapSets', JSON.stringify(allSets));
            saveStatus.style.display = '';
            setTimeout(() => { saveStatus.style.display = 'none'; }, 1500);
        });

        // Initial load
        loadGearSetsForJob(jobSelect.value);
        </script>
    </main>
    <footer>
        <p>&copy; 2025 FFXI Gear Swap Management</p>
    </footer>
</div>
</body>
</html>
