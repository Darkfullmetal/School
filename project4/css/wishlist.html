<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wishlist - FFXI Gear Swap Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="wrapper">
    <header>
        <div class="wishlist-header-images">
            <img src="https://raw.githubusercontent.com/Darkfullmetal/School/refs/heads/main/project4/images/ffxiclasses.jpg" class="wishlist-header-img left" alt="FFXI Classes">
            <h1>Wishlist</h1>
            <img src="https://raw.githubusercontent.com/Darkfullmetal/School/refs/heads/main/project4/images/ffxiclasses.jpg" class="wishlist-header-img right" alt="FFXI Classes">
        </div>
        <nav>
            <a href="index.html">Home</a>
            <a href="#" id="character-link">Character</a>
            <a href="#" id="wishlist-link" class="active">Wishlist</a>
            <a href="tips.html">Tips/Links</a>
            <a href="signin.html">Sign In/Register</a>
            <a href="#" id="signout-link">Sign Out</a>
        </nav>
    </header>
    <main>
        <div class="wishlist-main-grid">
            <div class="wishlist-left">
                <h2>My Wishlist (Up to 100 Items)</h2>
                <div id="wishlist-locked" style="display:none; color:red; font-weight:bold;">You must be signed in to access your wishlist.</div>
                <form id="wishlist-form" style="display:none;">
                    <label for="item-name">Item Name:</label>
                    <input type="text" id="item-name" name="item-name" maxlength="50" required>
                    <button type="submit">Add Item</button>
                    <button id="save-wishlist-btn" type="button" style="margin-left:10px;">Save Wishlist</button>
                    <span id="wishlist-save-status" style="margin-left:10px;color:green;display:none;">Saved!</span>
                </form>
                <ol class="wishlist-list" id="wishlist-list" style="display:none; margin-top:20px;">
                    <!-- Wishlist items will be dynamically added here -->
                </ol>
            </div>
            <div class="wishlist-right">
                <h2>Gear Swap Sets</h2>
                <form id="gearswap-form" style="display:inline;">
                    <label for="gs-job-select">Select Job:</label>
                    <select id="gs-job-select" name="gs-job">
                        <option value="Warrior">Warrior</option>
                        <option value="Monk">Monk</option>
                        <option value="White Mage">White Mage</option>
                        <option value="Black Mage">Black Mage</option>
                        <option value="Red Mage">Red Mage</option>
                        <option value="Thief">Thief</option>
                        <option value="Paladin">Paladin</option>
                        <option value="Dark Knight">Dark Knight</option>
                        <option value="Beastmaster">Beastmaster</option>
                        <option value="Bard">Bard</option>
                        <option value="Ranger">Ranger</option>
                        <option value="Samurai">Samurai</option>
                        <option value="Ninja">Ninja</option>
                        <option value="Dragoon">Dragoon</option>
                        <option value="Summoner">Summoner</option>
                        <option value="Blue Mage">Blue Mage</option>
                        <option value="Corsair">Corsair</option>
                        <option value="Puppetmaster">Puppetmaster</option>
                        <option value="Dancer">Dancer</option>
                        <option value="Scholar">Scholar</option>
                        <option value="Geomancer">Geomancer</option>
                        <option value="Rune Fencer">Rune Fencer</option>
                    </select>
                </form>
                <div class="gearswap-set-grid">
                    <div id="gearswap-sets-container"></div>
                    <button id="save-gearswap-btn" type="button">Save Sets for Job</button>
                    <div id="gearswap-save-status" style="margin-top:10px;color:green;display:none;">Saved!</div>
                </div>
            </div>
        </div>
        <script>
        // Only clear sign-in when leaving the site entirely, and add 30 min timeout
        function setSignInTimeout() {
    localStorage.setItem('signedInUserTimeout', Date.now() + 30 * 60 * 1000);
}
function checkSignInTimeout() {
    var timeout = localStorage.getItem('signedInUserTimeout');
    if (!timeout || Date.now() > parseInt(timeout)) {
        localStorage.removeItem('signedInUser');
        localStorage.removeItem('signedInUserTimeout');
        window.location.href = 'signin.html';
    }
}
document.body.addEventListener('mousemove', setSignInTimeout);
document.body.addEventListener('keydown', setSignInTimeout);
document.body.addEventListener('click', setSignInTimeout);
window.addEventListener('unload', function(e) {
    if (!document.referrer || !document.referrer.includes(window.location.hostname)) {
        localStorage.removeItem('signedInUser');
        localStorage.removeItem('signedInUserTimeout');
    }
});
var signedIn = localStorage.getItem('signedInUser');
checkSignInTimeout();
if (!signedIn) {
    window.location.href = 'signin.html';
} else {
    document.getElementById('wishlist-form').style.display = '';
    document.getElementById('wishlist-list').style.display = '';
    setSignInTimeout();
    var signoutLink = document.getElementById('signout-link');
    signoutLink.classList.add('show-signout');
    signoutLink.onclick = function(e) {
        e.preventDefault();
        localStorage.removeItem('signedInUser');
        localStorage.removeItem('signedInUserTimeout');
        window.location.href = 'index.html';
    };
}
        // Wishlist logic with remove and save
        function renderWishlist() {
            const list = document.getElementById('wishlist-list');
            list.innerHTML = '';
            let items = JSON.parse(localStorage.getItem('wishlistItems') || '[]');
            items.forEach((item, idx) => {
                const li = document.createElement('li');
                li.textContent = item;
                // Remove button
                const btn = document.createElement('button');
                btn.textContent = 'Remove';
                btn.type = 'button';
                btn.style.marginLeft = '10px';
                btn.onclick = function() {
                    items.splice(idx, 1);
                    localStorage.setItem('wishlistItems', JSON.stringify(items));
                    renderWishlist();
                };
                li.appendChild(btn);
                list.appendChild(li);
            });
        }

        if (signedIn) {
            // Initial render
            renderWishlist();
            // Add item
            document.getElementById('wishlist-form').addEventListener('submit', function(e) {
                e.preventDefault();
                var itemName = document.getElementById('item-name').value.trim();
                let items = JSON.parse(localStorage.getItem('wishlistItems') || '[]');
                if (itemName && items.length < 100) {
                    items.push(itemName);
                    localStorage.setItem('wishlistItems', JSON.stringify(items));
                    document.getElementById('item-name').value = '';
                    renderWishlist();
                }
            });
            // Save wishlist
            document.getElementById('save-wishlist-btn').addEventListener('click', function() {
                let items = [];
                const list = document.getElementById('wishlist-list');
                for (let i = 0; i < list.children.length; i++) {
                    items.push(list.children[i].childNodes[0].nodeValue.trim());
                }
                localStorage.setItem('wishlistItems', JSON.stringify(items));
                document.getElementById('wishlist-save-status').style.display = '';
                setTimeout(() => { document.getElementById('wishlist-save-status').style.display = 'none'; }, 1500);
            });
        }
        // Per-job gear swap sets logic
        const gearSlots = [
            'Main', 'Sub', 'Range', 'Ammo',
            'Head', 'Neck', 'Ear1', 'Ear2',
            'Body', 'Hands', 'Ring1', 'Ring2',
            'Back', 'Waist', 'Legs', 'Feet'
        ];
        const setNames = ['TP', 'WS', 'Idle', 'DT', 'Special'];
        const jobSelect = document.getElementById('gs-job-select');
        const setsContainer = document.getElementById('gearswap-sets-container');
        const saveBtn = document.getElementById('save-gearswap-btn');
        const saveStatus = document.getElementById('gearswap-save-status');

        function createGearSetTable(setName, values) {
            let html = `<table class='gearswap-grid-table'><thead><tr><th colspan='4'>${setName}</th></tr></thead><tbody>`;
            for (let r = 0; r < 4; r++) {
                html += '<tr>';
                for (let c = 0; c < 4; c++) {
                    let idx = r * 4 + c;
                    let slot = gearSlots[idx];
                    let val = values && values[slot] ? values[slot] : '';
                    html += `<td><input type='text' maxlength='30' pattern='[A-Za-z0-9\-\+]*' title='${slot}' placeholder='${slot}' value='${val}'></td>`;
                }
                html += '</tr>';
            }
            html += '</tbody></table>';
            return html;
        }

        function loadGearSetsForJob(job) {
            let allSets = JSON.parse(localStorage.getItem('gearswapSets') || '{}');
            let jobSets = allSets[job] || {};
            setsContainer.innerHTML = '';
            setNames.forEach(setName => {
                let values = jobSets[setName] || {};
                let setDiv = document.createElement('div');
                setDiv.className = 'gearswap-set-block';
                setDiv.innerHTML = createGearSetTable(setName, values);
                setsContainer.appendChild(setDiv);
            });
        }

        jobSelect.addEventListener('change', function() {
            loadGearSetsForJob(jobSelect.value);
            saveStatus.style.display = 'none';
        });

        saveBtn.addEventListener('click', function() {
            let allSets = JSON.parse(localStorage.getItem('gearswapSets') || '{}');
            let job = jobSelect.value;
            let jobSets = {};
            let setBlocks = setsContainer.getElementsByClassName('gearswap-set-block');
            for (let i = 0; i < setNames.length; i++) {
                let setName = setNames[i];
                let inputs = setBlocks[i].getElementsByTagName('input');
                let setVals = {};
                for (let j = 0; j < gearSlots.length; j++) {
                    setVals[gearSlots[j]] = inputs[j].value;
                }
                jobSets[setName] = setVals;
            }
            allSets[job] = jobSets;
            localStorage.setItem('gearswapSets', JSON.stringify(allSets));
            saveStatus.style.display = '';
            setTimeout(() => { saveStatus.style.display = 'none'; }, 1500);
        });

        // Initial load
        loadGearSetsForJob(jobSelect.value);
        </script>
<script>
// Intercept Character/Wishlist clicks to show sign-in if not signed in
document.getElementById('character-link').onclick = function(e) {
    var signedIn = localStorage.getItem('signedInUser');
    if (!signedIn) {
        e.preventDefault();
        window.location.href = 'signin.html';
    }
};
document.getElementById('wishlist-link').onclick = function(e) {
    var signedIn = localStorage.getItem('signedInUser');
    if (!signedIn) {
        e.preventDefault();
        window.location.href = 'signin.html';
    }
};
</script>
    </main>
    <footer>
        <p>&copy; 2025 FFXI Gear Swap Management</p>
    </footer>
</div>
</body>
</html>
